<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Identifica el Sustantivo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Configuraci贸n de fuente y colores de Tailwind -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Fondo suave */
        }
        .sentence-word {
            cursor: pointer;
            transition: all 0.2s;
            display: inline-block;
            padding: 0.25rem 0.5rem;
            margin: 0 0.1rem;
            border-radius: 0.5rem;
            font-weight: 600;
        }
        .sentence-word:hover {
            background-color: #e0f2fe; /* light-blue-100 */
            transform: translateY(-2px);
        }
        .selected-word {
            background-color: #bae6fd; /* light-blue-200, para la palabra actualmente seleccionada */
            border: 2px solid #00bfff; /* color del borde para la selecci贸n */
        }
        .correct-answer {
            background-color: #bbf7d0; /* green-200 */
            border: 2px solid #10b981; /* green-500 */
        }
        .incorrect-answer {
            background-color: #fecaca; /* red-200 */
            border: 2px solid #ef4444; /* red-500 */
        }
        .speaker-icon {
            flex-shrink: 0; /* Evita que el 铆cono se encoja */
            transition: transform 0.2s;
        }
        .speaker-icon:hover {
            transform: scale(1.1);
        }
    </style>
</head>
<body class="p-4 md:p-8 flex items-center justify-center min-h-screen">

    <!-- Contenedor Principal de la Aplicaci贸n -->
    <div class="w-full max-w-2xl bg-white shadow-2xl rounded-xl p-6 md:p-10 border-4 border-sky-500">
        
        <h1 class="text-3xl md:text-4xl font-extrabold text-sky-700 mb-6 text-center border-b-2 pb-2">
             Identifica el Sustantivo
        </h1>
        
        <p class="text-gray-600 text-lg mb-6 text-center">
            Haz clic en el <span class="font-bold text-sky-600">altavoz ()</span> para escuchar la oraci贸n o haz clic en la palabra que creas que es el **sustantivo**.
        </p>

        <!-- rea de las Oraciones -->
        <div id="sentence-container" class="space-y-6">
            <!-- Las oraciones se cargar谩n aqu铆 por JavaScript -->
        </div>

        <!-- Indicador de Puntuaci贸n -->
        <div class="mt-8 pt-4 border-t-2 text-center">
            <p class="text-xl font-bold text-gray-700">Puntuaci贸n: <span id="score" class="text-sky-600">0/10</span></p>
        </div>

    </div>

    <!-- Modal (Ventana Emergente de Confirmaci贸n) -->
    <div id="modal" class="fixed inset-0 bg-gray-900 bg-opacity-70 hidden items-center justify-center p-4 z-50 transition-opacity duration-300">
        <div class="bg-white rounded-lg shadow-2xl p-6 w-full max-w-sm transform transition-transform duration-300 scale-95">
            <h2 class="text-2xl font-bold text-gray-800 mb-4" id="modal-title">驴Es este el Sustantivo?</h2>
            
            <p class="text-gray-600 mb-6">驴Est谩s seguro de que **<span id="word-to-confirm" class="font-extrabold text-sky-600"></span>** es el sustantivo de la oraci贸n?</p>
            
            <div id="feedback-message" class="hidden p-3 mb-4 rounded-lg font-bold"></div>

            <div class="flex justify-end space-x-3">
                <button id="cancel-button" class="px-4 py-2 bg-gray-300 text-gray-800 font-semibold rounded-lg hover:bg-gray-400 transition">Cancelar</button>
                <button id="confirm-button" class="px-4 py-2 bg-sky-600 text-white font-semibold rounded-lg hover:bg-sky-700 transition">Confirmar</button>
                <button id="next-button" class="px-4 py-2 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 transition hidden">Siguiente Oraci贸n</button>
            </div>
        </div>
    </div>

    <script>
        // Array de oraciones. Cada objeto incluye la oraci贸n dividida y la posici贸n (铆ndice) de la palabra correcta (sustantivo).
        // NOTA: El 铆ndice es base 0.
        const sentences = [
            {
                text: "El perro come afuera.",
                words: ["El", "perro", "come", "afuera."],
                nounIndex: 1, // "perro"
                solved: false
            },
            {
                text: "Mi abuela prepara galletas deliciosas.",
                words: ["Mi", "abuela", "prepara", "galletas", "deliciosas."],
                nounIndex: 1, // "abuela"
                solved: false
            },
            {
                text: "Los ni帽os juegan en el parque.",
                words: ["Los", "ni帽os", "juegan", "en", "el", "parque."],
                nounIndex: 1, // "ni帽os"
                solved: false
            },
            {
                text: "El libro est谩 sobre la mesa.",
                words: ["El", "libro", "est谩", "sobre", "la", "mesa."],
                nounIndex: 1, // "libro"
                nounIndex2: 5, // "mesa" (opci贸n secundaria v谩lida)
                solved: false
            },
            {
                text: "Ella compr贸 unas flores rojas.",
                words: ["Ella", "compr贸", "unas", "flores", "rojas."],
                nounIndex: 3, // "flores"
                solved: false
            },
            {
                text: "El sol brilla fuerte hoy.",
                words: ["El", "sol", "brilla", "fuerte", "hoy."],
                nounIndex: 1, // "sol"
                solved: false
            },
            {
                text: "Mi amigo trae un regalo.",
                words: ["Mi", "amigo", "trae", "un", "regalo."],
                nounIndex: 1, // "amigo"
                nounIndex2: 4, // "regalo"
                solved: false
            },
            {
                text: "La jirafa es alta.",
                words: ["La", "jirafa", "es", "alta."],
                nounIndex: 1, // "jirafa"
                solved: false
            },
            {
                text: "Un rat贸n corri贸 r谩pido.",
                words: ["Un", "rat贸n", "corri贸", "r谩pido."],
                nounIndex: 1, // "rat贸n"
                solved: false
            },
            {
                text: "El mar est谩 tranquilo.",
                words: ["El", "mar", "est谩", "tranquilo."],
                nounIndex: 1, // "mar"
                solved: false
            }
        ];

        let currentSentenceIndex = 0;
        let selectedWordIndex = -1;
        let selectedSentenceElement = null;
        let score = 0;

        const modal = document.getElementById('modal');
        const wordToConfirm = document.getElementById('word-to-confirm');
        const confirmButton = document.getElementById('confirm-button');
        const cancelButton = document.getElementById('cancel-button');
        const feedbackMessage = document.getElementById('feedback-message');
        const scoreElement = document.getElementById('score');
        const nextButton = document.getElementById('next-button');

        // Funci贸n para leer la oraci贸n (Text-to-Speech)
        function speakSentence(text) {
            if ('speechSynthesis' in window) {
                // Si la voz est谩 hablando, la detenemos antes de iniciar la nueva
                if (window.speechSynthesis.speaking) {
                    window.speechSynthesis.cancel();
                }
                
                const utterance = new SpeechSynthesisUtterance(text);
                
                const voices = speechSynthesis.getVoices();
                // Intenta encontrar una voz en espa帽ol
                const spanishVoice = voices.find(voice => voice.lang === 'es-ES' || voice.lang.startsWith('es'));
                
                if (spanishVoice) {
                    utterance.voice = spanishVoice;
                } else {
                    utterance.lang = 'es'; // Fallback a espa帽ol si no se encuentra la voz espec铆fica
                }
                
                utterance.rate = 0.9; // Un poco m谩s lento para los ni帽os
                window.speechSynthesis.speak(utterance);
            } else {
                console.error("El navegador no soporta la API de Text-to-Speech.");
            }
        }
        
        // Exponer la funci贸n globalmente
        window.speakSentence = speakSentence;


        // Funci贸n para renderizar todas las oraciones
        function renderSentences() {
            const container = document.getElementById('sentence-container');
            container.innerHTML = ''; // Limpia el contenedor

            sentences.forEach((sentence, sIndex) => {
                const sentenceDiv = document.createElement('div');
                // A帽adimos 'items-center' para alinear el 铆cono con el texto
                sentenceDiv.className = 'text-2xl mb-4 p-4 rounded-lg bg-gray-50 shadow-md flex flex-wrap items-center';
                sentenceDiv.id = `sentence-${sIndex}`;

                // 1. A帽adir el 铆cono del altavoz (Speaker Icon)
                const speakerIconDiv = document.createElement('div');
                speakerIconDiv.className = 'speaker-icon text-sky-600 mr-3 cursor-pointer';
                // Usando un SVG de altavoz (Lucide icon: Volume-2)
                speakerIconDiv.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-volume-2">
                        <polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/>
                        <path d="M15.54 8.46a5 5 0 0 1 0 7.08"/>
                        <path d="M19.07 4.93a10 10 0 0 1 0 14.14"/>
                    </svg>
                `;
                speakerIconDiv.addEventListener('click', () => {
                    speakSentence(sentence.text);
                });
                sentenceDiv.appendChild(speakerIconDiv);


                // 2. A帽adir las palabras de la oraci贸n
                sentence.words.forEach((word, wIndex) => {
                    const wordSpan = document.createElement('span');
                    wordSpan.textContent = word + (wIndex < sentence.words.length - 1 ? ' ' : ''); // A帽ade espacio excepto al final
                    wordSpan.className = 'sentence-word';
                    wordSpan.dataset.sentenceIndex = sIndex;
                    wordSpan.dataset.wordIndex = wIndex;

                    if (sentence.solved) {
                        // Marca la palabra correcta si ya fue resuelta
                        if (wIndex === sentence.nounIndex || (sentence.nounIndex2 !== undefined && wIndex === sentence.nounIndex2)) {
                             wordSpan.classList.add('correct-answer');
                        } else {
                            wordSpan.classList.add('text-gray-600');
                        }
                    }

                    // Previene hacer click si ya est谩 resuelta
                    if (!sentence.solved) {
                        wordSpan.addEventListener('click', handleWordClick);
                    }
                    
                    sentenceDiv.appendChild(wordSpan);
                });
                container.appendChild(sentenceDiv);
            });

            updateScoreDisplay();
        }

        // Manejador del click en cualquier palabra
        function handleWordClick(event) {
            const target = event.target;
            const sIndex = parseInt(target.dataset.sentenceIndex);
            const wIndex = parseInt(target.dataset.wordIndex);

            // Resetea cualquier selecci贸n previa de la misma oraci贸n
            if (selectedSentenceElement) {
                selectedSentenceElement.querySelectorAll('.sentence-word').forEach(span => {
                    span.classList.remove('selected-word');
                });
            }

            // Marca la palabra actual como seleccionada
            target.classList.add('selected-word');

            currentSentenceIndex = sIndex;
            selectedWordIndex = wIndex;
            selectedSentenceElement = document.getElementById(`sentence-${sIndex}`);

            // Configura y muestra el modal
            wordToConfirm.textContent = target.textContent.trim();
            showModal();
        }

        // Muestra el modal, reiniciando el estado de retroalimentaci贸n
        function showModal() {
            feedbackMessage.classList.add('hidden');
            confirmButton.classList.remove('hidden');
            nextButton.classList.add('hidden');
            modal.classList.remove('hidden');
            setTimeout(() => modal.children[0].classList.add('scale-100'), 10);
        }

        // Oculta el modal y limpia la selecci贸n visual
        function hideModal() {
            modal.children[0].classList.remove('scale-100');
            setTimeout(() => {
                modal.classList.add('hidden');
                
                // Limpiar selecci贸n visual si la oraci贸n a煤n no ha sido resuelta
                if (selectedSentenceElement && !sentences[currentSentenceIndex].solved) {
                    selectedSentenceElement.querySelectorAll('.sentence-word').forEach(span => {
                        span.classList.remove('selected-word');
                    });
                }
                selectedWordIndex = -1;
                selectedSentenceElement = null;
            }, 300);
        }
        
        // Funci贸n de evaluaci贸n
        function evaluateAnswer() {
            const sentence = sentences[currentSentenceIndex];
            
            // Verifica si el 铆ndice seleccionado es una respuesta correcta
            const isCorrect = selectedWordIndex === sentence.nounIndex || 
                              (sentence.nounIndex2 !== undefined && selectedWordIndex === sentence.nounIndex2);

            // Muestra el mensaje de retroalimentaci贸n en el modal
            feedbackMessage.classList.remove('hidden');
            
            // Oculta el bot贸n de confirmar y muestra el bot贸n de siguiente si es correcto
            confirmButton.classList.add('hidden');
            cancelButton.classList.add('hidden');

            if (isCorrect) {
                feedbackMessage.className = 'p-3 mb-4 rounded-lg font-bold bg-green-100 text-green-700';
                feedbackMessage.textContent = '隆Correcto! 隆Ese es el Sustantivo!';
                
                if (!sentence.solved) {
                    score++;
                    sentence.solved = true;
                }
                
                // Encuentra el elemento de la palabra correcta y apl铆cale el estilo
                const correctWordSpan = selectedSentenceElement.querySelector(`[data-word-index="${selectedWordIndex}"]`);
                if (correctWordSpan) {
                    correctWordSpan.classList.add('correct-answer');
                    correctWordSpan.classList.remove('selected-word');
                }

                nextButton.classList.remove('hidden'); // Ocultar por ahora, simplemente cerrar
                renderSentences(); // Volver a renderizar para deshabilitar clicks
                
            } else {
                feedbackMessage.className = 'p-3 mb-4 rounded-lg font-bold bg-red-100 text-red-700';
                feedbackMessage.textContent = '隆Incorrecto! Vuelve a intentarlo.';
                
                // Quita la selecci贸n para que el estudiante pueda intentar de nuevo
                selectedSentenceElement.querySelectorAll('.sentence-word').forEach(span => {
                    span.classList.remove('selected-word');
                });
                
                cancelButton.classList.remove('hidden');
                
                // Retrasa el cierre del modal para que el usuario lea el feedback
                setTimeout(hideModal, 1500); 
            }
            updateScoreDisplay();
        }

        function updateScoreDisplay() {
            scoreElement.textContent = `${score}/${sentences.length}`;
        }

        // Asignaci贸n de Event Listeners a los botones del modal
        cancelButton.addEventListener('click', hideModal);
        confirmButton.addEventListener('click', evaluateAnswer);
        nextButton.addEventListener('click', hideModal); // El bot贸n "Siguiente" ahora solo cierra el modal y permite seguir con la actividad

        // Iniciar la aplicaci贸n
        window.onload = renderSentences;
        
    </script>
</body>
</html>
