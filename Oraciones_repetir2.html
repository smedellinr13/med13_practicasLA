
/**
 * Generates random simple sentences for 1st graders.
 * Uses categorized patterns to ensure semantic sense.
 * Includes fantasy themes as requested.
 * Max 4 words typically (Subject + Verb + Object).
 */

interface SentencePattern {
  subjects: string[];
  verbs: string[];
  objects: string[];
}

const patterns: SentencePattern[] = [
  // 1. Fantasy - Action & Magic (Fantasía - Acción)
  {
    subjects: ["El dragón", "El hada", "El mago", "La bruja", "El duende", "El genio", "El rey", "La reina"],
    verbs: ["hace", "tiene", "usa", "lanza", "busca", "ve", "cuida"],
    objects: ["magia", "fuego", "oro", "nubes", "luz", "alas", "el trono", "joyas"]
  },
  // 2. Fantasy - Movement (Fantasía - Movimiento)
  {
    subjects: ["El dragón", "El pegaso", "La nave", "El fénix", "La nube", "El cohete"],
    verbs: ["vuela", "sube", "baja", "cruza", "va", "pasa"],
    objects: ["alto", "rápido", "lejos", "veloz", "bien", "fuerte"]
  },
  // 3. Animals - Eating (Animales - Comida)
  {
    subjects: ["El oso", "El gato", "El perro", "La vaca", "El ratón", "El león", "El pato", "El tigre"],
    verbs: ["come", "busca", "pide", "huele", "mira", "quiere"],
    objects: ["miel", "pan", "queso", "fruta", "pasto", "agua", "carne", "pescado"]
  },
  // 4. Family/Kids - Daily Life (Vida Diaria)
  {
    subjects: ["El niño", "La niña", "Mi mamá", "Mi papá", "El bebé", "Mi tía", "Mi abuela"],
    verbs: ["lee", "toma", "juega", "usa", "abre", "lava", "mira"],
    objects: ["libros", "leche", "fútbol", "ropa", "la caja", "el mapa", "la flor"]
  },
  // 5. Description - Colors & States (Descripción)
  {
    subjects: ["El sol", "La luna", "El mar", "La flor", "El coche", "La casa", "El cielo"],
    verbs: ["es", "está", "se ve", "parece"],
    objects: ["grande", "azul", "rojo", "lindo", "feliz", "suave", "bello", "alto"]
  },
  // 6. Emotions & Feelings (Emociones)
  {
    subjects: ["El rey", "La reina", "El oso", "El niño", "La niña", "El perro"],
    verbs: ["está", "se siente", "parece"],
    objects: ["feliz", "triste", "bien", "mal", "fuerte", "cansado"]
  }
];

export const generateRandomSentence = (): string => {
  // 1. Pick a random pattern category
  const patternIndex = Math.floor(Math.random() * patterns.length);
  const pattern = patterns[patternIndex];

  // 2. Pick random words from that category
  const sub = pattern.subjects[Math.floor(Math.random() * pattern.subjects.length)];
  const vrb = pattern.verbs[Math.floor(Math.random() * pattern.verbs.length)];
  const obj = pattern.objects[Math.floor(Math.random() * pattern.objects.length)];

  let sentence = `${sub} ${vrb} ${obj}`;

  // 3. Add Punctuation (Statement, Question, or Exclamation)
  const type = Math.random();
  
  if (type < 0.20) {
    // 20% chance of Question
    return `¿${sentence}?`;
  } else if (type < 0.40) {
    // 20% chance of Exclamation
    return `¡${sentence}!`;
  } else {
    // 60% chance of Statement
    return `${sentence}.`;
  }
};

// Helper to get a clean text for comparison (remove dots, lowercase)
export const normalizeText = (text: string): string => {
  if (!text) return "";
  return text
    .toLowerCase()
    // Regex removes standard punctuation and inverted Spanish marks
    .replace(/[.,\/#!$%\^&\*;:{}=\-_`~()¿?¡!]/g, "")
    .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // Remove accents for lenient matching (mamá vs mama)
    .trim();
};
