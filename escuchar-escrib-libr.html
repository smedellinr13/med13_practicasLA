import React from 'react';
import { MAX_REPETITIONS, SLOW_DOWN_THRESHOLD } from '../types';

interface ProgressBarProps {
  currentRepetition: number;
  isPlaying: boolean;
}

export const ProgressBar: React.FC<ProgressBarProps> = ({ currentRepetition, isPlaying }) => {
  return (
    <div className="w-full max-w-md mx-auto mb-6">
      <div className="flex justify-between text-xs font-bold text-slate-400 mb-2 uppercase tracking-wider">
        <span>Normal ({SLOW_DOWN_THRESHOLD}x)</span>
        <span>Lento ({MAX_REPETITIONS - SLOW_DOWN_THRESHOLD}x)</span>
      </div>
      <div className="flex gap-1 h-4">
        {Array.from({ length: MAX_REPETITIONS }).map((_, idx) => {
          const stepNumber = idx + 1;
          const isFilled = stepNumber <= currentRepetition;
          const isActive = isPlaying && stepNumber === currentRepetition;
          
          let bgColor = 'bg-slate-200';
          if (isActive) bgColor = 'bg-blue-500 animate-pulse shadow-[0_0_10px_rgba(59,130,246,0.5)]';
          else if (isFilled) bgColor = 'bg-blue-400';

          // Differentiate slow rounds
          const isSlowRound = stepNumber > SLOW_DOWN_THRESHOLD;
          const borderColor = isSlowRound ? 'border-orange-200' : 'border-transparent';
          
          // Highlight slow rounds color if active or filled
          if (isSlowRound && (isActive || isFilled)) {
             if (isActive) bgColor = 'bg-orange-500 animate-pulse shadow-[0_0_10px_rgba(249,115,22,0.5)]';
             else bgColor = 'bg-orange-400';
          }

          return (
            <div
              key={idx}
              className={`flex-1 rounded-full transition-all duration-300 ${bgColor} ${borderColor} border-2`}
              title={isSlowRound ? "Velocidad Lenta" : "Velocidad Normal"}
            />
          );
        })}
      </div>
      <div className="text-center mt-2 text-sm text-slate-500 h-5 flex items-center justify-center">
        {currentRepetition > 0 ? (
          <span>
            Repetición {currentRepetition} de {MAX_REPETITIONS}
            {currentRepetition > SLOW_DOWN_THRESHOLD && <span className="text-orange-500 font-bold ml-2">¡Más lento!</span>}
            {isPlaying && <span className="ml-2 text-blue-500 text-xs animate-pulse">Reproduciendo...</span>}
          </span>
        ) : (
             <span className="text-slate-400 italic">Pulsa reproducir para comenzar</span>
        )}
      </div>
    </div>
  );
};